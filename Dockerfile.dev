# NODE_VERSION is set by default in the config.ts, the following value will only
# be used if you build images by default with docker build
ARG NODE_VERSION=24
FROM node:${NODE_VERSION}-alpine

ENV NODE_ENV=production
WORKDIR /app/source

RUN apk --no-cache add tini ca-certificates bash

# Install nodemon globally so we can use it with the CMD
RUN corepack enable && pnpm add -g nodemon@3.1.4

EXPOSE 5678

# set up the volumes
VOLUME /app/config /app/logs /app/assets
ENV TERAFOUNDATION_CONFIG=/app/config/teraslice.yaml

# Make tini PID 1, then exec your service
ENTRYPOINT ["/sbin/tini", "--"]
CMD ["nodemon", "--exitcrash", "service.js"]
