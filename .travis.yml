sudo: required
language: node_js
node_js:
- '8'
services:
- docker
cache:
    directories:
    - $HOME/docker
before_cache:
- >
    mkdir -p $HOME/docker && docker images -a --filter='dangling=false' --format '{{.Repository}}:{{.Tag}} {{.ID}}'
    | xargs -n 2 -t sh -c 'test -e $HOME/docker/$1.tar.gz || docker save $0 | gzip -2 > $HOME/docker/$1.tar.gz'
before_install:
- if [[ -d $HOME/docker ]]; then ls $HOME/docker/*.tar.gz | xargs -I {file} sh -c "zcat {file} | docker load"; fi
script:
- time make test
- time env MODE=qa make integration-tests
after_success:
- make lint || echo "Let's show the lint output here but we don't want it cause a failure yet"
- yarn report-coverage
deploy:
  provider: npm
  email: peter@terascope.io
  api_key:
    secure: IbA84R9gLLdyCaMhkvqkhgeDxcIX85LLQZbY3WbWxrw7b7zrD64+NQSkV0vztYKldlGIPqW2FmuL92FYGpb2O3WLF/jVi/cttKtiUhFZ7OXF7di7882AW+GJ6ZvKaZ/Vsb3VY5D+Rdkad1xOpZsQdDWjCOFMMYkzpsL5KRin1gpV4Os5GCZ11c40lujABVktBt+jLyxXNqpI9Reh9j3+elq+jnuZnAApVAghNQUkslFgWH7C4m2dweMieytC3zMJJYX+xnAFrA6pbZIkhEIz1pgjjPuErhZGXtEBUQ0rH9fb+N6Ooq4l5LHuvLDh22gT7gTGvyBQrNpfFWEcNP7O8I3ophHG3t/6dXfudYrEJejtxYjSXnQweXLExkEZdaiCpEOA1SlZAYghPFYg1HSuEuXguiGf/vi9UC4rPuVbLm9gQO94EMK/BHFEpFDRqiHE5Mva4rzuYXUeuMtln0dkMancxh8b0alC0XaNeG9VbWAlUIvlAErczBvqD82GDo/vF06oWOzLS5eTH0dDVvgRint0fLNgofAL7WX2KO2wohS/S9tNpIiBr+L7FZLoNWIi0jhENNCse22VVOUlmPI+2AYa/p0X7TCOwQX7Ua2MRajzjxCyNsKv9e5VpRuY4Jio102aIymXucAIecx6yPGIbUW6ioSCVJ2SCt2+voHW89E=
  on:
    branch: master
    tags: true
    repo: terascope/teraslice
